---
title: A another look at matrix factorization for the pancreas data
author: Peter Carbonetto
output: workflowr::wflow_html
---

[The previous analysis](pancreas_factors.html) applied different
matrix factorization approaches to the
[full pancreas data set](pancreas.html). A key challenge in analyzing
the full pancreas data set is that there are large batch or data-set
effects, which some matrix factorization approaches have difficulty
dealing with (particularly the topic model). Here we look more closely
at a couple of the individual data sets to highlight better how the
different factorizations yield different representations of the
underlying structure in the cells without the added complication of
dealing with the batch effects.

```{r knitr-opts, include=FALSE}
knitr::opts_chunk$set(comment = "#",collapse = TRUE,results = "hold",
                      fig.align = "center",dpi = 120)
```

First, load the packages needed for this analysis.

```{r load-pkgs, message=FALSE}
library(Matrix)
library(fastTopics)
library(ggplot2)
library(cowplot)
```

Set the seed for reproducibility.

```{r set-seed}
set.seed(1)
```

### CEL-Seq2 data

Let's start with the "CEL-Seq2" data from [the Muraro et al 2016
paper][muraro-2016]. (The data were generated using the CEL-Seq2
protocol.)

First load the CEL-Seq2 pancreas data and the outputs generated by
running the `compute_pancreas_celseq2_factors.R` script.

```{r load-data}
load("../data/pancreas.RData")
load("../output/pancreas_celseq2_factors.RData")
i           <- which(sample_info$tech == "celseq2")
sample_info <- sample_info[i,]
counts      <- counts[i,]
sample_info <- transform(sample_info,celltype = factor(celltype))
```

[muraro-2016]: https://doi.org/10.1016/j.cels.2016.09.002
